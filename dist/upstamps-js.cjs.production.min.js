"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("node-fetch"))&&"object"==typeof e&&"default"in e?e.default:e;function r(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var n="https://services.upstamps.com/api";exports.default=function(){function e(e){var t=e.projectKey,r=e.envKey;this.clientId=e.clientId,this.projectKey=t,this.envKey=r}var o=e.prototype;return o.scopes=function(e){try{var o=this;return Promise.resolve(r((function(){return Promise.resolve(t(n+"/"+o.clientId+"/"+o.projectKey+"/scopes/add",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify({name:e.name,email:e.email})})).then((function(e){return Promise.resolve(e.json()).then((function(e){return void 0!==e.response&&e.response.errors.length>0?{error:!0,message:"Uniqueness violation. duplicate email value violates unique constraint"}:{error:!1,success:!0,message:"Scope created"}}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},o.flag=function(e){try{var o=this;return Promise.resolve(r((function(){return Promise.resolve(t(n+"/"+o.clientId+"/"+o.projectKey+"/"+o.envKey+"/flags")).then((function(t){return Promise.resolve(t.json()).then((function(t){return-1!==t.flags.map((function(e){return e.name})).indexOf(e)}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},o.remote=function(e){try{var o=this;return Promise.resolve(r((function(){return Promise.resolve(t(n+"/"+o.clientId+"/"+o.projectKey+"/"+o.envKey+"/remotes")).then((function(t){return Promise.resolve(t.json()).then((function(t){var r=t.remotes.filter((function(t){return t.name===e}));return r.length>0?{show:!0,data:r[0].data}:{show:!1}}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},o.test=function(e){try{var o=this;return Promise.resolve(r((function(){var i=["A","B"],s=n+"/"+o.clientId+"/"+o.projectKey+"/"+o.envKey+"/testing";return Promise.resolve(t(s)).then((function(n){return Promise.resolve(n.json()).then((function(n){var o=n.ABTesting.filter((function(t){return t.name===e})).length>0,c=Math.floor(Math.random()*i.length);return{show:o,variant:i[c],emitter:function(){return Promise.resolve(r((function(){return Promise.resolve(function(e,n,o){return Promise.resolve(r((function(){return Promise.resolve(t(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify({name:n,varA:"A"===e?1:0,varB:"B"===e?1:0})})).then((function(e){return Promise.resolve(e.json())}))}),(function(e){return e})))}(i[c],e,s))}),(function(e){return e})))}}}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},o.segment=function(e,o){try{var i=this;return Promise.resolve(r((function(){var r=n+"/"+i.clientId+"/"+i.projectKey+"/"+i.envKey+"/segment",s=function(e){var t=encodeURIComponent;return Object.keys(e).filter((function(t){return void 0!==e[t]&&e[t]&&null!==e[t]})).map((function(r){return t(r)+"="+t(e[r])})).join("&")}({name:e,country:o.country,client:o.client,clientType:o.clientType});return Promise.resolve(t(r+"?"+s,{method:"GET"})).then((function(e){return Promise.resolve(e.json()).then((function(e){return{show:e.segment.length>0}}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},e}();
//# sourceMappingURL=upstamps-js.cjs.production.min.js.map
