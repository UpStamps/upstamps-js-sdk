"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("node-fetch"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var r="https://services.upstamps.com/api";exports.default=function(){function e(e){var t=e.projectKey,n=e.envKey;this.clientId=e.clientId,this.projectKey=t,this.envKey=n}var o=e.prototype;return o.flags=function(e){try{return Promise.resolve(t(r+"/"+this.clientId+"/"+this.projectKey+"/"+this.envKey+"/flags")).then((function(t){return Promise.resolve(t.json()).then((function(t){return-1!==t.flags.map((function(e){return e.name})).indexOf(e)}))}))}catch(e){return Promise.reject(e)}},o.remote=function(e){try{return Promise.resolve(t(r+"/"+this.clientId+"/"+this.projectKey+"/"+this.envKey+"/remotes")).then((function(t){return Promise.resolve(t.json()).then((function(t){var n=t.remotes.filter((function(t){return t.name===e}));return n.length>0?{show:!0,data:n[0].data}:{show:!1}}))}))}catch(e){return Promise.reject(e)}},o.test=function(e){try{var o=["A","B"],i=r+"/"+this.clientId+"/"+this.projectKey+"/"+this.envKey+"/testing";return Promise.resolve(t(i)).then((function(r){return Promise.resolve(r.json()).then((function(r){var s=r.ABTesting.filter((function(t){return t.name===e})).length>0,c=Math.floor(Math.random()*o.length);return{show:s,variant:o[c],emitter:function(){return Promise.resolve(n((function(){return Promise.resolve(function(e,r,o){return Promise.resolve(n((function(){return Promise.resolve(t(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify({name:r,varA:"A"===e?1:0,varB:"B"===e?1:0})})).then((function(e){return Promise.resolve(e.json())}))}),(function(e){return e})))}(o[c],e,i))}),(function(e){return e})))}}}))}))}catch(e){return Promise.reject(e)}},o.segment=function(e,n){try{var o=r+"/"+this.clientId+"/"+this.projectKey+"/"+this.envKey+"/segment",i=function(e){var t=encodeURIComponent;return Object.keys(e).filter((function(t){return void 0!==e[t]&&e[t]&&null!==e[t]})).map((function(n){return t(n)+"="+t(e[n])})).join("&")}({name:e,country:n.country,client:n.client,clientType:n.clientType});return Promise.resolve(t(o+"?"+i,{method:"GET"})).then((function(e){return Promise.resolve(e.json()).then((function(e){return{show:e.segment.length>0}}))}))}catch(e){return Promise.reject(e)}},e}();
//# sourceMappingURL=upstamps-js.cjs.production.min.js.map
